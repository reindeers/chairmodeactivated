<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<html lang = "ru">
<head>
<title></title>
</head>
<body>
<script>

/*alert({a: 5, b: 6}.length);
Object.prototype.length = function(){
	return Object.keys(Object).length;
}();*/

var constrTable = function(fTable){
	var that = this;
	return{
		from: fTable["from"] || "not identf",
		to: fTable["to"] || "not identf",
		getFrom: function(){
			return this.from;
		},
		getTo: function(){
			return this.to;
		}
	}
}



var cardSet = (function(){
	var nCard = [],
		that = this,
		notSortTables = {
			
			"card0": {"from": "Лондон", "to": "Прага"},
			"card1": {"from": "Прага", "to": "Вильнюс"},
			"card2": {"from": "Москва", "to": "Лондон"}, //первая,
			"card3": {"from": "Вильнюс", "to": "Питер"},
			"card4": {"from": "Питер", "to": "Пекин"}
		}, //выбирать с сервера
		cardCount = Object.keys(notSortTables).length,
		nCardSort = [],
		uObj = {};
		
	return {
		doSet: function(){
			for (var i = 0; i < 5; i++){ //TODO: рефакторинг
				var pName = "card" + i;
				nCard[i] = constrTable(notSortTables[pName]);
			}
		}(),
		
		getSet: function(){
			return nCard;
		},
		
		hashAdd: function (){ //сделать рекурсивно
			var hArr = [];
			uObj = {uniqId: 0, uniqTabl: "Москва"};	
			
			for (var j = 0; j < (nCard.length - 1); j++){
				var cSet0 = nCard[j],
					cSet1 = nCard[j+1],
					count = 0;
				
				
				
				hArr.push(cSet0.getTo());

				var checkUniq = function(){
					for (var i = 0; i < hArr.length; i++){
						if (cSet1.getFrom() != hArr[i])  count++; uniqT = cSet1.getFrom(); 
					}
					if (count == hArr.length) uObj.uniqTabl = uniqT; uObj.uniqId = count;
				}
			
			} //TODO: рефакторинг
			
			checkUniq();
	
		},
		
		sortCard: function () {
			this.hashAdd();
			nCardSort.push(nCard[uObj.uniqId]);
			nCard.splice(uObj.uniqId, 1);
			console.log(uObj);
			console.log(nCard);
		
		}
	}
}());

var testSet = cardSet;
console.log(testSet.getSet());
testSet.sortCard();

</script>
</body>
</html>
